/*! For license information please see 1b1006d9aa8d8b6f0f11.js.LICENSE.txt */
function _regenerator(){var e,n,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",o=t.toStringTag||"@@toStringTag";function a(t,r,o,a){var s=r&&r.prototype instanceof c?r:c,l=Object.create(s.prototype);return _regeneratorDefine2(l,"_invoke",function(t,r,o){var a,c,s,l=0,u=o||[],d=!1,m={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(n,t){return a=n,c=0,s=e,m.n=t,i}};function f(t,r){for(c=t,s=r,n=0;!d&&l&&!o&&n<u.length;n++){var o,a=u[n],f=m.p,p=a[2];t>3?(o=p===r)&&(s=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=t<2&&f<a[1])?(c=0,m.v=r,m.n=a[1]):f<p&&(o=t<3||a[0]>r||r>p)&&(a[4]=t,a[5]=r,m.n=p,c=0))}if(o||t>1)return i;throw d=!0,r}return function(o,u,p){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,p),c=u,s=p;(n=c<2?e:s)||!d;){a||(c?c<3?(c>1&&(m.n=-1),f(c,s)):m.n=s:m.v=s);try{if(l=2,a){if(c||(o="next"),n=a[o]){if(!(n=n.call(a,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,c<2&&(c=0)}else 1===c&&(n=a.return)&&n.call(a),c<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((n=(d=m.n<0)?s:t.call(r,m))!==i)break}catch(n){a=e,c=1,s=n}finally{l=1}}return{value:n,done:d}}}(t,o,a),!0),l}var i={};function c(){}function s(){}function l(){}n=Object.getPrototypeOf;var u=[][r]?n(n([][r]())):(_regeneratorDefine2(n={},r,function(){return this}),n),d=l.prototype=c.prototype=Object.create(u);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return s.prototype=l,_regeneratorDefine2(d,"constructor",l),_regeneratorDefine2(l,"constructor",s),s.displayName="GeneratorFunction",_regeneratorDefine2(l,o,"GeneratorFunction"),_regeneratorDefine2(d),_regeneratorDefine2(d,o,"Generator"),_regeneratorDefine2(d,r,function(){return this}),_regeneratorDefine2(d,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:a,m:m}})()}function _regeneratorDefine2(e,n,t,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}_regeneratorDefine2=function(e,n,t,r){function a(n,t){_regeneratorDefine2(e,n,function(e){return this._invoke(n,t,e)})}n?o?o(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(a("next",0),a("throw",1),a("return",2))},_regeneratorDefine2(e,n,t,r)}function asyncGeneratorStep(e,n,t,r,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void t(e)}c.done?n(s):Promise.resolve(s).then(r,o)}function _asyncToGenerator(e){return function(){var n=this,t=arguments;return new Promise(function(r,o){var a=e.apply(n,t);function i(e){asyncGeneratorStep(a,r,o,i,c,"next",e)}function c(e){asyncGeneratorStep(a,r,o,i,c,"throw",e)}i(void 0)})}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,n){if(e){if("string"==typeof e)return _arrayLikeToArray(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,n):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}var CONFIG={API_URL:"http://127.0.0.1:8000/api/emails",EMAIL_REGEX:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,RH_EMAIL:"bravo-merci@entreprise.com"},isInitialized=!1;function init(){prefillNominateur(),attachEventHandlers()}function attachEventHandlers(){var e=document.getElementById("sendBtn");if(e){var n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("click",handleSendMessage)}document.querySelectorAll("input, textarea").forEach(function(e){e.addEventListener("input",clearMessages)})}function prefillNominateur(){try{var e=Office.context.mailbox.userProfile;fillNominateurFields((null==e?void 0:e.displayName)||"Nom inconnu",(null==e?void 0:e.emailAddress)||"email@inconnu.com")}catch(e){console.error("Erreur lors du pré-remplissage:",e),showError("Impossible de récupérer les informations utilisateur.")}}function fillNominateurFields(e,n){document.getElementById("nominateur-nom").innerText=e,document.getElementById("nominateur-email").innerText=n,document.getElementById("date-envoi").innerText=(new Date).toLocaleDateString("fr-FR")}function isValidEmail(e){return CONFIG.EMAIL_REGEX.test(e)}function getInvalidEmails(e){return e.filter(function(e){return!isValidEmail(e)})}function parseEmailField(e){var n;return((null===(n=document.getElementById(e))||void 0===n?void 0:n.value)||"").split(/[,;]+/).map(function(e){return e.trim()}).filter(function(e){return e})}function validateForm(){var e,n,t=[],r=parseEmailField("to"),o=parseEmailField("cc"),a=parseEmailField("bcc"),i=(null===(e=document.getElementById("subject"))||void 0===e?void 0:e.value.trim())||"",c=(null===(n=document.getElementById("message"))||void 0===n?void 0:n.value.trim())||"",s=getCheckedValues(".valeur"),l=getCheckedValues(".critere");r.length||t.push("Le champ 'Destinataire(s)' est obligatoire."),i||t.push("Le champ 'Objet' est obligatoire."),s.length||t.push("Veuillez sélectionner au moins une valeur reconnue."),l.length||t.push("Veuillez sélectionner au moins un critère de reconnaissance."),c||t.push("Le champ 'Message' est obligatoire.");var u=getInvalidEmails([].concat(_toConsumableArray(r),_toConsumableArray(o),_toConsumableArray(a)));return u.length&&t.push("Adresse(s) email invalide(s) : ".concat(u.join(", "))),{isValid:0===t.length,errors:t,data:{to:r,cc:o,bcc:a,subject:i,message:c,valeurs:s,criteres:l}}}function getCheckedValues(e){return Array.from(document.querySelectorAll("".concat(e,":checked"))).map(function(e){return e.value})}function buildMessageBody(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=(new Date).toLocaleDateString("fr-FR"),a="",i="";if("undefined"!=typeof Office&&Office.context&&Office.context.mailbox){var c=Office.context.mailbox.userProfile;c&&(a=c.displayName||a,i=c.emailAddress||i)}return'\n<!doctype html>\n<html lang="fr">\n  <head>\n    <meta charset="UTF-8" />\n    <title>Bravo & Merci</title>\n  </head>\n\n  <body style="margin:0;padding:0;background-color:#fff;">\n    <div style="width:100%;padding:24px 0;background-color:#f3f2f1;">\n\n      \x3c!-- Container --\x3e\n      <div style="\n        max-width:600px;\n        margin:0 auto;\n        background-color:#ffffff;\n        border-radius:4px;\n        padding:28px;\n        font-family:Segoe UI, Arial, sans-serif;\n        color:#1f1f1f;\n      ">\n\n        \x3c!-- Header --\x3e\n        <div style="margin-bottom:24px;">\n          <img src="'.concat("https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRg-Me-63CZ3XXkow-vhNX4xV_lsFk-gYIxzA&s",'" width="160" alt="SGCI" />\n        </div>\n\n        \x3c!-- Meta informations --\x3e\n        <div style="\n          font-size:13px;\n          line-height:18px;\n          color:#4a4a4a;\n          margin-bottom:24px;\n          padding-left:12px;\n          border-left:3px solid #e60028;\n        ">\n          <div><strong>Date d’envoi :</strong> ').concat(o,"</div>\n          <div><strong>Nom du nominateur :</strong> ").concat(a,"</div>\n          <div><strong>Email du nominateur :</strong> ").concat(i,'</div>\n        </div>\n\n        \x3c!-- Objet --\x3e\n        <div style="margin-bottom:20px;">\n          <div style="\n            font-size:12px;\n            text-transform:uppercase;\n            letter-spacing:0.4px;\n            color:#605e5c;\n            margin-bottom:6px;\n          ">\n            Objet\n          </div>\n          <div style="\n            font-size:17px;\n            font-weight:600;\n            line-height:22px;\n            color:#000000;\n          ">\n           ').concat(e,'\n          </div>\n        </div>\n\n        \x3c!-- Divider --\x3e\n        <div style="height:1px;background-color:#edebe9;margin:24px 0;"></div>\n\n        \x3c!-- Valeurs --\x3e\n        ').concat(t.length?'\n        <div style="margin-bottom:20px;">\n          <div style="\n            font-size:14px;\n            font-weight:600;\n            margin-bottom:8px;\n            color:#000000;\n          ">\n            Valeur Société Générale reconnue\n          </div>\n          '.concat(t.map(function(e){return'\n          <span style="\n            display:inline-block;\n            background-color:#fde7ea;\n            color:#a4001d;\n            padding:5px 12px;\n            border-radius:14px;\n            font-size:12px;\n            margin:4px 6px 0 0;\n          ">\n            '.concat(e,"\n          </span>")}).join(""),"\n        </div>"):"","\n\n        \x3c!-- Critères --\x3e\n        ").concat(r.length?'\n        <div style="margin-bottom:24px;">\n          <div style="\n            font-size:14px;\n            font-weight:600;\n            margin-bottom:8px;\n            color:#000000;\n          ">\n            Critère(s) de reconnaissance\n          </div>\n          '.concat(r.map(function(e){return'\n          <span style="\n            display:inline-block;\n            background-color:#f2f2f2;\n            color:#1f1f1f;\n            padding:5px 12px;\n            border-radius:14px;\n            font-size:12px;\n            margin:4px 6px 0 0;\n          ">\n            '.concat(e,"\n          </span>")}).join(""),"\n        </div>"):"",'\n\n        \x3c!-- Message --\x3e\n        <div style="margin-bottom:24px;">\n          <div style="\n            font-size:14px;\n            font-weight:600;\n            margin-bottom:8px;\n            color:#000000;\n          ">\n            Message de reconnaissance\n          </div>\n\n          <div style="\n            font-size:15px;\n            line-height:22px;\n            color:#1f1f1f;\n          ">\n            ').concat(n.replace(/\n/g,"<br>"),'\n          </div>\n        </div>\n\n        \x3c!-- Footer --\x3e\n        <div style="\n          border-top:1px solid #edebe9;\n          padding-top:12px;\n          font-size:11px;\n          color:#6b6b6b;\n          text-align:left;\n        ">\n          Message envoyé via le programme de reconnaissance interne SGCI.\n        </div>\n\n      </div>\n    </div>\n  </body>\n</html>\n  ')}Office.onReady(function(e){e.host!==Office.HostType.Outlook||isInitialized||(isInitialized=!0,init())});var isSending=!1;function handleSendMessage(e){return _handleSendMessage.apply(this,arguments)}function _handleSendMessage(){return(_handleSendMessage=_asyncToGenerator(_regenerator().m(function e(n){var t,r,o,a,i,c,s,l,u,d,m,f,p;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n.preventDefault(),!isSending){e.n=1;break}return e.a(2);case 1:if(isSending=!0,clearMessages(),(t=validateForm()).isValid){e.n=2;break}return showError(t.errors.join("<br>")),isSending=!1,e.a(2);case 2:return setLoading(!0),e.p=3,r=t.data,o=r.to,a=r.cc,i=r.bcc,c=r.subject,s=r.message,l=r.valeurs,u=r.criteres,d=_toConsumableArray(i),CONFIG.RH_EMAIL&&!d.includes(CONFIG.RH_EMAIL)&&d.push(CONFIG.RH_EMAIL),htmlBody=buildMessageBody(c,s,l,u),m=prepareDataForDatabase(o,a,d,c,s,l,u),f={toRecipients:toEmailAddressDetails(o),ccRecipients:a.length?toEmailAddressDetails(a):void 0,bccRecipients:d.length?toEmailAddressDetails(d):void 0,subject:c,htmlBody:htmlBody},e.n=4,openOutlookCompose(f);case 4:return e.n=5,saveToDatabase(m);case 5:showSuccess("Reconnaissance envoyée avec succès ! Le message a été sauvegardé."),setTimeout(function(){resetForm(),isSending=!1},2e3),e.n=7;break;case 6:e.p=6,p=e.v,showError("Erreur lors de l'envoi : ".concat(p.message)),isSending=!1;case 7:return e.p=7,setLoading(!1),e.f(7);case 8:return e.a(2)}},e,null,[[3,6,7,8]])}))).apply(this,arguments)}function toEmailAddressDetails(e){return e.map(function(e){return{emailAddress:e,displayName:e}})}function openOutlookCompose(e){return _openOutlookCompose.apply(this,arguments)}function _openOutlookCompose(){return(_openOutlookCompose=_asyncToGenerator(_regenerator().m(function e(n){return _regenerator().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,t){try{if("function"==typeof Office.context.mailbox.displayNewMessageForm)Office.context.mailbox.displayNewMessageForm(n),e();else if(Office.context.mailbox.item)composeInCurrentContext(n),e();else{var r=createMailtoUrl(n);window.open(r,"_blank"),e()}}catch(e){t(new Error("Impossible d'ouvrir le formulaire Outlook : ".concat(e.message)))}}))},e)}))).apply(this,arguments)}function composeInCurrentContext(e){var n=Office.context.mailbox.item;e.subject&&n.subject.setAsync(e.subject),e.toRecipients&&n.to.setAsync(e.toRecipients),e.ccRecipients&&n.cc.setAsync(e.ccRecipients),e.bccRecipients&&n.bcc.setAsync(e.bccRecipients),e.htmlBody&&n.body.setAsync(e.htmlBody,{coercionType:Office.CoercionType.Html})}function createMailtoUrl(e){var n,t,r,o=(null===(n=e.toRecipients)||void 0===n?void 0:n.map(function(e){return e.emailAddress}).join(","))||"",a="mailto:".concat(o),i=[];if(null!==(t=e.ccRecipients)&&void 0!==t&&t.length){var c=e.ccRecipients.map(function(e){return e.emailAddress}).join(",");i.push("cc=".concat(encodeURIComponent(c)))}if(null!==(r=e.bccRecipients)&&void 0!==r&&r.length){var s=e.bccRecipients.map(function(e){return e.emailAddress}).join(",");i.push("bcc=".concat(encodeURIComponent(s)))}if(e.subject&&i.push("subject=".concat(encodeURIComponent(e.subject))),e.htmlBody){var l=e.htmlBody.replace(/<[^>]*>/g,"");i.push("body=".concat(encodeURIComponent(l)))}return i.length&&(a+="?".concat(i.join("&"))),a}function prepareDataForDatabase(e,n,t,r,o,a,i){var c,s;return{nominateur_nom:(null===(c=document.getElementById("nominateur-nom"))||void 0===c?void 0:c.innerText)||"",nominateur_email:(null===(s=document.getElementById("nominateur-email"))||void 0===s?void 0:s.innerText)||"",to:e,cc:n,bcc:t,subject:r,message_body:o,valeurs:a,criteres:i}}function saveToDatabase(e){return _saveToDatabase.apply(this,arguments)}function _saveToDatabase(){return(_saveToDatabase=_asyncToGenerator(_regenerator().m(function e(n){var t,r,o,a;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch(CONFIG.API_URL,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(n)});case 1:if((t=e.v).ok){e.n=3;break}return e.n=2,t.json().catch(function(){return{}});case 2:throw r=e.v,new Error(r.message||"Erreur API : ".concat(t.status));case 3:return e.n=4,t.json();case 4:return o=e.v,console.log("Données sauvegardées dans la BD:",o),e.a(2,o);case 5:throw e.p=5,a=e.v,console.error("Erreur lors de la sauvegarde en BD:",a),new Error("Sauvegarde en base de données échouée : ".concat(a.message));case 6:return e.a(2)}},e,null,[[0,5]])}))).apply(this,arguments)}function showError(e){var n=document.getElementById("error");n&&(n.innerHTML=e,n.scrollIntoView({behavior:"smooth",block:"nearest"}))}function showSuccess(e){var n=document.getElementById("success");n&&(n.innerText=e,n.scrollIntoView({behavior:"smooth",block:"nearest"}))}function clearMessages(){var e=document.getElementById("error"),n=document.getElementById("success");e&&(e.innerHTML=""),n&&(n.innerText="")}function setLoading(e){var n=document.getElementById("sendBtn");n&&(e?(n.disabled=!0,n.classList.add("loading"),n.innerHTML='<span class="ms-Button-label">Envoi en cours...</span>'):(n.disabled=!1,n.classList.remove("loading"),n.innerHTML='<span class="ms-Button-label">Envoyer la reconnaissance</span>'))}function resetForm(){document.getElementById("to").value="",document.getElementById("cc").value="",document.getElementById("bcc").value="",document.getElementById("subject").value="",document.getElementById("message").value="",document.querySelectorAll(".valeur, .critere").forEach(function(e){e.checked=!1}),clearMessages()}function showDebug(e){var n=document.getElementById("debugOutput");if(n){var t=(new Date).toLocaleTimeString();n.textContent+="[".concat(t,"] ").concat(e,"\n")}}